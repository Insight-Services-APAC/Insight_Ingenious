<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Dbt Build Process - Generative AI Accelerator - By Insight</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.0, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../../css/style.min.css" rel="stylesheet">
<link href="../../assets/stylesheets/extra.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href="../.." target="_blank" class="custom-link">Generative AI Accelerator - By Insight</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="../..">Home</a>
<li class="header">User guide</li>

<li>
<a href="../" class="">User Guide</a>
</li>

<li>
<a href="../initial_setup/" class="">Environment Setup</a>
</li>

<li>
<a href="../dbt_project_setup/" class="">DBT Project Setup</a>
</li>

<li>
<a href="./" class="active">Dbt Build Process</a>
</li>

<li>
<a href="../development_workflow/" class="">Development Workflow</a>
</li>

<li>
<a href="../fabric_ci_cd_process/" class="">Fabric CI/CD with Git Deployment</a>
</li>

<li class="header">Developer guide</li>

<li>
<a href="../../developer_guide/" class="">Developer Guide</a>
</li>

<li>
<a href="../../developer_guide/applications_setup/" class="">Applications Required for Development (Windows)</a>
</li>

<li>
<a href="../../developer_guide/dbt_setup/" class="">Setting Up dbt</a>
</li>

<li>
<a href="../../developer_guide/folder_structure/" class="">Repo Folder Structure</a>
</li>

<li>
<a href="../../developer_guide/framework_setup/" class="">Framework Setup</a>
</li>

<li>
<a href="../../developer_guide/initial_setup/" class="">Initial setup</a>
</li>

<li class="header">Documentation guide</li>

<li>
<a href="../../documentation_guide/" class="">Documentation Guide</a>
</li>

<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="dbt-build-process">Dbt Build Process<a class="headerlink" href="#dbt-build-process" title="Permanent link">&para;</a></h1>
<h2 id="run-the-build-script">Run the build script<a class="headerlink" href="#run-the-build-script" title="Permanent link">&para;</a></h2>
<p>Run the build script that you created in the previous step using the code below in the terminal.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Be sure to replace <mark>my_project</mark> with the name of your dbt project folder.</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">python</span> <span class="n">post_install</span><span class="p">.</span><span class="n">py</span> <span class="n">my_project</span> 
</code></pre></div>
<h2 id="additional-steps-for-the-first-run">Additional Steps for the First Run<a class="headerlink" href="#additional-steps-for-the-first-run" title="Permanent link">&para;</a></h2>
<p>The first time that you run this script you will get a warning that the metadata json files are not present. You will need to follow the steps in the warning message to download the metadata json files from your Fabric Lakehouse. These steps are as follows: </p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> In a pwsh terminal run the script below. This will set an environment variable that will be used by steps later on. Be sure to replace <mark>my_project</mark> with the name of your dbt project folder.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nv">$env:DBT_PROJECT_DIR</span> <span class="p">=</span> <span class="s2">&quot;my_project&quot;</span>
</code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> In the same terminal now run the script below. This will upload a series of notebooks to a folder in your Fabric workspace
    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">Invoke-Expression</span> <span class="n">-Command</span> <span class="nv">$env:DBT_PROJECT_DIR</span><span class="p">/</span><span class="n">target</span><span class="p">/</span><span class="n">pwsh</span><span class="p">/</span><span class="n">upload</span><span class="p">.</span><span class="n">ps1</span>
</code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Now run the following code to output the path to the import notebook. This will be used to import the notebooks into your workspace:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">Get-Childitem</span> <span class="s2">&quot;$env:DBT_PROJECT_DIR/target/notebooks/import_*&quot;</span> <span class="p">|</span> <span class="p">%</span> <span class="p">{</span><span class="nb">Write-Host</span> <span class="nv">$_</span><span class="p">.</span><span class="n">FullName</span><span class="p">}</span>
</code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Now login to the Fabric Portal and navigate to the workspace and lakehouse you are using and import the notebook using the path from the previous step.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">How to manually upload a notebook</p>
<p>See <a href="https://learn.microsoft.com/en-us/fabric/data-engineering/how-to-use-notebook#import-existing-notebooks">https://learn.microsoft.com/en-us/fabric/data-engineering/how-to-use-notebook#import-existing-notebooks</a></p>
</div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Open the notebook in the workspace and run all cells. This will upload the generated notebooks to your workspace.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> A new notebook should appear in the workspace called metadata_<mark>my_project</mark>_extract.ipynb where the text <mark>my_project</mark> is replaced with the name of your dbt_project. Open this notebook and run all cells. This will generate the metadata extract json files and place them in the metaextracts sub-directory of your lakehouse.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Now, back in your powershell terminal. Run the script below. This will download the metadata extract json files to a subfolder in your dbt project directory called metaextracts.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">Invoke-Expression</span> <span class="n">-Command</span> <span class="nv">$env:DBT_PROJECT_DIR</span><span class="p">/</span><span class="n">target</span><span class="p">/</span><span class="n">pwsh</span><span class="p">/</span><span class="n">download</span><span class="p">.</span><span class="n">ps1</span>
</code></pre></div></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that the above script runs azcopy to download the metadata extract json files from the lakehouse. Prior to running the script you may need to log in to the appropriate environment. Usually this is done using <code>azcopy login</code>. However, if you have access to multiple Microsoft entra domains you may need to specify the tenant id. This can be done by running <code>azcopy login --tenant-id &lt;tenant_id&gt;</code>. </p>
</div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Now re-run the dbt build script.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">python</span> <span class="n">post_install</span><span class="p">.</span><span class="n">py</span> <span class="n">my_project</span> 
</code></pre></div></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the script above be sure to replace <mark>my_project</mark> with the name of your dbt project folder.</p>
</div>
<p>When you run this build script successfully, you will see a series of notebooks generated in your <mark>my_project</mark>/target/notebooks directory. This is the <code>"special sauce"</code> of this dbt-adapter that allows your to run your dbt project natively as notebooks in a Fabric workspace. The image below shows a sample listing of generated notebooks. Your specific notebooks will be contain the name of your dbt project and may be different depending on the models and tests that you have defined in your dbt project. </p>
<h4 id="sample-listing-of-generated-notebooks">Sample listing of Generated Notebooks<a class="headerlink" href="#sample-listing-of-generated-notebooks" title="Permanent link">&para;</a></h4>
<p><img alt="notebooks" src="/assets/images/notebooks.png" /></p>
<p>If you study the files shown above you will notice that there is a naming convention and that the notebooks are prefixed with a specific string. The following table explains at a high level the naming convention and the purpose of each type of notebook.</p>
<table>
<thead>
<tr>
<th>Notebook Prefix</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>model.</td>
<td>These are dbt <strong>model</strong> notebooks. A notebook will be generated for each dbt <strong>model</strong> that you define. You will be able to run, debug and monitor execution of these notebooks directly in the Fabric portal independently of dbt.</td>
</tr>
<tr>
<td>test.</td>
<td>These are dbt <strong>test</strong> notebooks. A notebook will be generated for each dbt <strong>test</strong> that you define. You will be able to run, debug and monitor execution of these notebooks directly in the Fabric portal independently of dbt.</td>
</tr>
<tr>
<td>seed.</td>
<td>These are dbt <strong>seed</strong> notebooks. A notebook will be generated for each dbt <strong>seed</strong> that you define. You will be able to run, debug and monitor execution of these notebooks directly in the Fabric portal independently of dbt.</td>
</tr>
<tr>
<td>master_</td>
<td>These are <strong>execution orchestration</strong> notebooks. They allow the running of your models, tests and seeds in parallel and in the correct order. They are what allow you to run your transformation pipelines independently of dbt as an orchestrator. In order to run your project simply schedule master.{project_name}.notebook.iypnb using Fabric's native scheduling functionality</td>
</tr>
<tr>
<td>import_</td>
<td>This is a helper notebook that facilitate import of generated notebooks into workspace.</td>
</tr>
<tr>
<td>metadata_</td>
<td>This is a helper notebook to facilitate generation of workspace metadata json files.</td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The green panels below provide a more detailed discussion of each type of notebook. Take a moment to expand each panel by clicking on it and read the detailed explanation of each type of notebook.</p>
</div>
<details class="question">
<summary>Notebooks with the Prefix <code>"model."</code></summary>
<p>These are dbt <strong>model</strong> notebooks. A notebook will be generated for each dbt <strong>model</strong> that you define. You will be able to run, debug and monitor execution of these notebooks directly in the Fabric portal independently of dbt.</p>
<p><img alt="alt text" src="./assets/images/model_notebook0.png" /></p>
<p><img alt="alt text" src="./assets/images/model_notebook1.png" /></p>
</details>
<details class="question">
<summary>Notebooks with the Prefix <code>"test."</code></summary>
<p>These are dbt <strong>test</strong> notebooks. A notebook will be generated for each dbt <strong>test</strong> that you define. You will be able to run, debug and monitor execution of these notebooks directly in the Fabric portal independently of dbt.</p>
</details>
<details class="question">
<summary>Notebooks with the Prefix <code>"seed."</code></summary>
<p>These are dbt <strong>seed</strong> notebooks. A notebook will be generated for each dbt <strong>seed</strong> that you define. You will be able to run, debug and monitor execution of these notebooks directly in the Fabric portal independently of dbt.</p>
</details>
<details class="question">
<summary>Notebooks with the Prefix <code>"master_"</code></summary>
<p>These are <strong>execution orchestration</strong> notebooks. They allow the running of your models, tests and seeds in parallel and in the correct order. They are what allow you to run your transformation pipelines independently of dbt as an orchestrator. In order to run your project simply schedule master.{project_name}.notebook.iypnb using Fabric's native scheduling functionality.</p>
</details>
<details class="question">
<summary>Notebooks with the Prefix <code>"import_"</code></summary>
<p>This is a helper notebook that facilitates import of generated notebooks into workspace.</p>
</details>
<details class="question">
<summary>Notebooks with the Prefix <code>"metadata_"</code></summary>
<p>This is a helper notebook to facilitates the generation of workspace metadata json files.</p>
</details>
<h3 id="post-build-steps-checks">Post Build Steps &amp; Checks<a class="headerlink" href="#post-build-steps-checks" title="Permanent link">&para;</a></h3>
<p>After a successful execution you can now upload your notebooks to your Fabric Workspace and run your dbt transformations against your lakehouse/s. To do this follow the steps below: </p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> In a pwsh terminal run the script below. This will set an environment variable that will be used by steps later on. Be sure to replace <mark>my_project</mark> with the name of your dbt project folder.
    <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">$env:DBT_PROJECT_DIR</span> <span class="p">=</span> <span class="s2">&quot;my_project&quot;</span>
</code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> In the same terminal now run the script below. This will upload a the generated notebooks to a folder in your Fabric workspace
    <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">Invoke-Expression</span> <span class="n">-Command</span> <span class="nv">$env:DBT_PROJECT_DIR</span><span class="p">/</span><span class="n">target</span><span class="p">/</span><span class="n">pwsh</span><span class="p">/</span><span class="n">upload</span><span class="p">.</span><span class="n">ps1</span>
</code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> In your Fabric workspace open the import_<mark>my_project</mark>_notebook and run all cells. This will upload the generated notebooks to your workspace. If they already exist they will be updated. In order to organise your workspace efficiently I suggest that you move them all into a folder called the matches the name of your dbt project. Don't worry, even if you upload a new version of the notebooks the folder structure will be mantained.</li>
</ul>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../../js/main.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../javascripts/tablesort.js"></script>
<script src="../../search/main.js"></script>
<script src="../../js/gitbook.min.js"></script>
<script src="../../js/theme.min.js"></script>
</body>
</html>